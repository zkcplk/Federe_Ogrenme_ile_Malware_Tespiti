import os
# Konsolda tensorflow ile ilgili gereksiz bir uyarı metninin kapatılması için kullanılır.
os.environ['TF_ENABLE_ONEDNN_OPTS'] = '0'

from client_functions import tekrarla
from other import remove_files, info_update, info_load

# Temel ayarlar, client_main.json dosyasından yüklenir.
info = info_load()
info['round_num'] = 1
info["loss"] = info['losses'][info['class_type']]
info["csv_file"] = info['csv_files'][info['class_type']]
# Başlangıç ayarları yeniden client_main.json dosyasına kaydedilir.
info_update(info)

# Önceki kullanımlardan kalan model dosyaları yeni çalıştırmada silinir.
remove_files('models/global')
remove_files('models/local')

print(f"Client {info['user_no']} için LOCAL_ROUND = {info['round_num']}")

try:
    # send_time sürede bir, benzer işlemler tekrarlanır.
    tekrarla(info['send_time'])

# Sunucu ile bağlantı problemi varsa, bu kısım çalışır.
except ConnectionRefusedError as hata:
    print("-------------------------------------")
    print("HATA: FL-Server ile bağlantı kesildi!")
    print("HATA MESAJI: ", hata)
    print("-------------------------------------")

# Öngörülemeyen diğer tüm hatalar için bu kısım çalışır.
except Exception as hata:
    print("-------------------------------------")
    print("HATA:", hata.__class__.__name__)
    print("HATA MESAJI: ", hata)
    print("-------------------------------------")
